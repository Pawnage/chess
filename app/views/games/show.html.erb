<h1 class="text-center">Chessboard WIP</h1>

<br />

<div class="col-xs-6 col-xs-offset-3">
  <table id="chessboard">
    <% 7.downto(0) do |row| %>
      <tr>
        <% 0.upto(7) do |col| %>
          <td>
            <% if piece = @pieces.detect { |piece| piece.row_position == row && piece.col_position == col && piece.alive } %>              
              <% if @selected_piece.nil? %>
                <%= link_to piece_path(piece) do %>
                  <%= render_piece(piece) %>
                <% end %>
              <% else %>
                <!-- if a piece is selected, every cell (even occupied ones) is a link to update the positions of the selected piece -->
                <%= link_to piece_path(@selected_piece, :row_position => row, :col_position => col), :method => :patch do %>
                  <% if piece == @selected_piece %>
                    <!-- highlight the piece that is selected -->
                    <%= render_piece(piece, true) %>
                  <% else %>
                    <%= render_piece(piece) %>
                  <% end %>
                <% end %>
              <% end %>
            <% elsif @selected_piece %>              
              <%= link_to piece_path(@selected_piece, :row_position => row, :col_position => col), :class => 'movable', :method => :patch do %>
                <div class="movable"></div>
              <% end %>
            <% end %>
          </td>
        <% end %>
      </tr>
    <% end %>
  </table>

  <br /><br />
</div>
